<script>
const API_URL = 'https://api.sheety.co/f7f2e9490f85889b2a23cbdcf031c17e/usersDb4/usersDb4';

async function loginUser() {
  const phone = document.getElementById("phone").value.trim();
  const password = document.getElementById("password").value.trim();

  document.body.innerHTML = "<h3>Step 1: Script started...</h3>";

  try {
    document.body.innerHTML += "<p>Step 2: Fetching from Sheety...</p>";

    const res = await fetch(API_URL);
    document.body.innerHTML += `<p>Step 3: Got response (${res.status})</p>`;

    const text = await res.text();
    document.body.innerHTML += `<p>Step 4: Raw response length ${text.length}</p>`;

    let data;
    try {
      data = JSON.parse(text);
      document.body.innerHTML += `<p>Step 5: JSON parsed</p>`;
    } catch (err) {
      document.body.innerHTML += `<p style='color:red;'>❌ JSON parse error: ${err.message}</p><pre>${text}</pre>`;
      return;
    }

    console.log("Parsed:", data);

    const users = data.usersDb4 || [];
    document.body.innerHTML += `<p>Step 6: Found ${users.length} users</p>`;

    const found = users.find(u => u.phone === phone && u.password === password);

    if (found) {
      document.body.innerHTML = `<h2>✅ Login Successful</h2><p>Welcome, ${found.telegram || found.phone}</p>`;
    } else {
      document.body.innerHTML += `<p style='color:red;'>Invalid phone or password</p>`;
    }

  } catch (err) {
    document.body.innerHTML += `<p style='color:red;'>Fatal error: ${err.message}</p>`;
  }
}
</script>
